From 0eeb6d6b57cb8e1c50c65915799fbd4a7b2b6c43 Mon Sep 17 00:00:00 2001
From: Andrew Eikum <aeikum@codeweavers.com>
Date: Tue, 24 Jul 2018 11:05:06 -0500
Subject: [PATCH 05/24] dsound: Correctly calculate angle between vectors with
 equal and opposite directions

Signed-off-by: Andrew Eikum <aeikum@codeweavers.com>
---
 dlls/dsound/sound3d.c | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/dlls/dsound/sound3d.c b/dlls/dsound/sound3d.c
index 03fd3d4..118bb60 100644
--- a/dlls/dsound/sound3d.c
+++ b/dlls/dsound/sound3d.c
@@ -111,7 +111,13 @@ static inline D3DVALUE AngleBetweenVectorsRad (const D3DVECTOR *a, const D3DVECT
 		return 0;
 
 	cos = product/(la*lb);
-	angle = acos(cos);
+	if(cos > 1.f){
+		angle = 0;
+	}else if(cos < -1.f){
+		angle = M_PI;
+	}else{
+		angle = acos(cos);
+	}
 	TRACE("angle between (%f,%f,%f) and (%f,%f,%f) = %f radians (%f degrees)\n",  a->x, a->y, a->z, b->x,
 	      b->y, b->z, angle, RadToDeg(angle));
 	return angle;	
-- 
1.9.1

